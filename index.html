<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>飞行射击 - 在线 Demo</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#000;height:100%;font-family:sans-serif;}
#gameCanvas{display:block;width:100vw;height:100vh;}
#ui{position:absolute;top:12px;left:12px;color:#fff;font-size:20px;text-shadow:0 0 6px #00f;user-select:none;}
#ui span{margin-right:20px;}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="ui"><span id="score">Score: 0</span><span id="life">Life: 3</span></div>

<script>
(() => {
    const canvas=document.getElementById('gameCanvas'),ctx=canvas.getContext('2d');
    const UI={score:document.getElementById('score'),life:document.getElementById('life')};
    const WIDTH=canvas.width=innerWidth,HEIGHT=canvas.height=innerHeight;
    const KEY={LEFT:false,RIGHT:false,UP:false,DOWN:false,SPACE:false};
    const PLAYER_SPEED=6,BULLET_SPEED=12,ENEMY_SPEED_BASE=2;
    let ENEMY_SPAWN_INTERVAL=1500,MAX_LIFE=3;
    const RES={img:{},audio:{}};
    const ASSETS={img:{player:'https://picsum.photos/seed/p/80/80',enemy1:'https://picsum.photos/seed/e1/70/70',enemy2:'https://picsum.photos/seed/e2/80/80',bullet:'https://picsum.photos/seed/b/20/20'},audio:{shoot:'https://freesound.org/data/previews/341/341695_5260870-lq.mp3',explode:'https://freesound.org/data/previews/320/320655_4939433-lq.mp3',bgm:'https://freesound.org/data/previews/459/459131_10292727-lq.mp3'}};
    function loadImages(list,cb){let total=Object.keys(list).length,loaded=0;for(let k in list){let img=new Image();img.src=list[k];img.onload=()=>{RES.img[k]=img;if(++loaded===total)cb();};}}
    function loadAudio(list,cb){let total=Object.keys(list).length,loaded=0;for(let k in list){let a=new Audio();a.src=list[k];a.volume=0.6;a.oncanplaythrough=()=>{RES.audio[k]=a;if(++loaded===total)cb();};}}
    function loadAll(onReady){loadImages(ASSETS.img,()=>loadAudio(ASSETS.audio,onReady));}
    class Entity{constructor(x,y,w,h,img){this.x=x;this.y=y;this.w=w;this.h=h;this.img=img;this.alive=true;}
        draw(){if(this.img)ctx.drawImage(this.img,this.x-this.w/2,this.y-this.h/2,this.w,this.h);}
        isColliding(o){let dx=this.x-o.x,dy=this.y-o.y,r1=Math.min(this.w,this.h)/2,r2=Math.min(o.w,o.h)/2;return dx*dx+dy*dy<(r1+r2)*(r1+r2);}
    }
    class Player extends Entity{constructor(){let i=RES.img.player,w=i.width*0.7,h=i.height*0.7;super(WIDTH/2,HEIGHT-h/2,w,h,i);this.life=MAX_LIFE;this.score=0;this.cd=0;}
        update(){if(KEY.LEFT) this.x-=PLAYER_SPEED; if(KEY.RIGHT) this.x+=PLAYER_SPEED; if(KEY.UP) this.y-=PLAYER_SPEED; if(KEY.DOWN) this.y+=PLAYER_SPEED;
            this.x=Math.max(this.w/2,Math.min(WIDTH-this.w/2,this.x));
            this.y=Math.max(this.h/2,Math.min(HEIGHT-this.h/2,this.y));
            if(KEY.SPACE && this.cd<=0){this.shoot();this.cd=10;}
            if(this.cd>0) this.cd--;
            UI.score.textContent='Score: '+this.score;
            UI.life.textContent='Life: '+this.life;
        }
        shoot(){let i=RES.img.bullet,w=i.width*0.3,h=i.height*0.3;bullets.push(new Bullet(this.x,this.y-this.h/2,w,h,i,-BULLET_SPEED));play('shoot');}
        hit(){this.life--;shake(8,200);if(this.life<=0)gameOver();}
    }
    class Enemy extends Entity{constructor(type=1){let i=type===1?RES.img.enemy1:RES.img.enemy2,scale=0.8,w=i.width*scale,h=i.height*scale,x=Math.random()*(WIDTH-w)+w/2;super(x,-h,w,h,i);this.type=type;this.speed=ENEMY_SPEED_BASE+Math.random()*1.5;this.hp=type===1?1:2;}
        update(){this.y+=this.speed;if(this.y-this.h/2>HEIGHT) this.alive=false;}
        hit(){this.hp--;if(this.hp<=0){this.alive=false;explode(this.x,this.y,this.w);play('explode');player.score+=this.type===1?100:250;shake(4,120);}}
    }
    class Bullet extends Entity{constructor(x,y,w,h,img,vy){super(x,y,w,h,img);this.vy=vy;this.trail=[];}
        update(){this.y+=this.vy;this.trail.push({x:this.x,y:this.y});if(this.trail.length>8) this.trail.shift();if(this.y<-this.h||this.y>HEIGHT+this.h) this.alive=false;}
        draw(){for(let i=0;i<this.trail.length;i++){let p=this.trail[i];let a=i/this.trail.length;ctx.save();ctx.globalAlpha=a*0.6;ctx.fillStyle=`hsl(${(performance.now()/10)%360},100%,60%)`;ctx.beginPath();ctx.arc(p.x,p.y,this.w*0.3,0,Math.PI*2);ctx.fill();ctx.restore();}
            super.draw();}
    }
    class Particle{constructor(x,y,r,c,l,vx,vy){this.x=x;this.y=y;this.r=r;this.c=c;this.life=l;this.vx=vx;this.vy=vy;}
        update(){this.x+=this.vx;this.y+=this.vy;this.life--;}
        draw(){let a=Math.max(this.life/30,0);ctx.save();ctx.globalAlpha=a;ctx.fillStyle=this.c;ctx.beginPath();ctx.arc(this.x,this.y,this.r,0,Math.PI*2);ctx.fill();ctx.restore();}
    }
    let player,bullets=[],enemies=[],particles=[],lastSpawn=0,spawnInt=ENEMY_SPAWN_INTERVAL,run=true,shake={mag:0,dur:0,start:0};
    function play(name){let s=RES.audio[name];if(!s) return;let c=s.cloneNode();c.play();}
    function explode(x,y,size){let cnt=Math.floor(size/4);for(let i=0;i<cnt;i++){let a=Math.random()*Math.PI*2,s=Math.random()*3+1,vx=Math.cos(a)*s,vy=Math.sin(a)*s,r=Math.random()*3+2,h=(performance.now()/10)%360,c=`hsl(${h},100%,60%)`;particles.push(new Particle(x,y,r,c,30,vx,vy));}}
    function shake(mag,dur){shake.mag=mag;shake.dur=dur;shake.start=performance.now();}
    function applyShake(){if(shake.dur<=0){ctx.setTransform(1,0,0,1,0,0);return;}let elapsed=performance.now()-shake.start;if(elapsed>shake.dur){shake.dur=0;ctx.setTransform(1,0,0,1,0,0);return;}let dx=(Math.random()-0.5)*shake.mag,dy=(Math.random()-0.5)*shake.mag;ctx.setTransform(1,0,0,1,dx,dy);}
    function gameOver(){run=false;if(RES.audio.bgm)RES.audio.bgm.pause();ctx.setTransform(1,0,0,1,0,0);ctx.fillStyle='rgba(0,0,0,0.8)';ctx.fillRect(0,0,WIDTH,HEIGHT);ctx.fillStyle='#ff5555';ctx.font='bold 64px sans-serif';ctx.textAlign='center';ctx.fillText('Game Over',WIDTH/2,HEIGHT/2-30);ctx.fillStyle='#fff';ctx.font='28px sans-serif';ctx.fillText('Score: '+player.score,WIDTH/2,HEIGHT/2+20);ctx.fillText('Press F5 to Restart',WIDTH/2,HEIGHT/2+70);}
    function loop(ts){if(!run) return;ctx.fillStyle='rgba(0,0,0,0.25)';ctx.fillRect(0,0,WIDTH,HEIGHT);applyShake();player.update();player.draw();bullets.forEach(b=>b.update());bullets.filter(b=>b.alive).forEach(b=>b.draw());enemies.forEach(e=>e.update());enemies.filter(e=>e.alive).forEach(e=>e.draw());particles.forEach(p=>p.update());particles.filter(p=>p.life>0).forEach(p=>p.draw());
        bullets.forEach(b=>enemies.forEach(e=>{if(b.alive&&e.alive&&b.isColliding(e)){b.alive=false;e.hit();}}));
        enemies.forEach(e=>{if(e.alive&&player.alive&&e.isColliding(player)){e.alive=false;e.hit();player.hit();}});
        [bullets,enemies,particles].forEach(arr=>{for(let i=arr.length-1;i>=0;i--) if(!arr[i].alive||arr[i].life===0) arr.splice(i,1);});
        if(ts-lastSpawn>spawnInt){enemies.push(new Enemy(Math.random()<0.7?1:2));lastSpawn=ts;spawnInt=Math.max(300,spawnInt*0.95);}
        requestAnimationFrame(loop);
    }
    function init(){player=new Player();if(RES.audio.bgm){RES.audio.bgm.loop=true;RES.audio.bgm.volume=0.4;RES.audio.bgm.play();}run=true;lastSpawn=performance.now();requestAnimationFrame(loop);}
    window.addEventListener('keydown',e=>{if(e.code==='ArrowLeft'||e.code==='KeyA')KEY.LEFT=true; if(e.code==='ArrowRight'||e.code==='KeyD')KEY.RIGHT=true; if(e.code==='ArrowUp'||e.code==='KeyW')KEY.UP=true; if(e.code==='ArrowDown'||e.code==='KeyS')KEY.DOWN=true; if(e.code==='Space')KEY.SPACE=true;});
    window.addEventListener('keyup',e=>{if(e.code==='ArrowLeft'||e.code==='KeyA')KEY.LEFT=false; if(e.code==='ArrowRight'||e.code==='KeyD')KEY.RIGHT=false; if(e.code==='ArrowUp'||e.code==='KeyW')KEY.UP=false; if(e.code==='ArrowDown'||e.code==='KeyS')KEY.DOWN=false; if(e.code==='Space')KEY.SPACE=false;});
    loadAll(init);
    window.addEventListener('resize',()=>{canvas.width=innerWidth;canvas.height=innerHeight;});
})();
</script>
</body>
</html>